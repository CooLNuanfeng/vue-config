(function(a,b){a.ui.refresh.register(function(){return{pluginName:"iscroll",_init:function(){var e=this,f=e._data,c=e.root(),d=c.height();e._initOrg();a.extend(f,{useTransition:true,speedScale:1,topOffset:f["$upElem"]?f["$upElem"].height():0});f.threshold=f.threshold||5;c.wrapAll(a('<div class="ui-refresh-wrapper"></div>').height(d)).css("height","auto");e._loadIscroll()},_changeStyle:function(c,g){var d=this,f=d._data,e=f.refreshInfo[c];d._changeStyleOrg(c,g);switch(g){case"loaded":e["$icon"].addClass("ui-refresh-icon");break;case"beforeload":e["$label"].html("\u677e\u5f00\u7acb\u5373\u52a0\u8f7d");e["$icon"].addClass("ui-refresh-flip");break;case"loading":e["$icon"].removeClass().addClass("ui-loading");break}return d},_loadIscroll:function(){var d=this,e=d._data,c=e.threshold;e.iScroll=new iScroll(d.root().parent().get(0),e.iScrollOpts=a.extend({useTransition:e.useTransition,speedScale:e.speedScale,topOffset:e.topOffset},e.iScrollOpts,{onScrollStart:function(f){d.trigger("scrollstart",f)},onScrollMove:(function(){var f=e.$upElem&&e.$upElem.length,g=e.$downElem&&e.$downElem.length;return function(l){var h=e._upRefreshed,i=e._downRefreshed,k=d._status("up"),j=d._status("down");if(f&&!k||g&&!j||this.maxScrollY>=0){return}if(j&&g&&!i&&this.y<(this.maxScrollY-c)){d._setMoveState("down","beforeload","pull")}else{if(k&&f&&!h&&this.y>c){d._setMoveState("up","beforeload","pull");this.minScrollY=0}else{if(j&&i&&this.y>(this.maxScrollY+c)){d._setMoveState("down","loaded","restore")}else{if(k&&h&&this.y<c){d._setMoveState("up","loaded","restore");this.minScrollY=-e.topOffset}}}}d.trigger("scrollmove",l)}})(),onScrollEnd:function(g){var f=e._actDir;if(f&&d._status(f)){d._setStyle(f,"loading");d._loadingAction(f,"pull")}d.trigger("scrollend",g)}}))},_setMoveState:function(c,g,e){var d=this,f=d._data;d._setStyle(c,g);f["_"+c+"Refreshed"]=e=="pull";f._actDir=e=="pull"?c:"";return d},afterDataLoading:function(c){var d=this,e=d._data,c=c||e._actDir;e.iScroll.refresh();e["_"+c+"Refreshed"]=false;return d.afterDataLoadingOrg(c)}}})})(Zepto);