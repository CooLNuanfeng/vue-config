(function(e,d){var f=["01\u6708","02\u6708","03\u6708","04\u6708","05\u6708","06\u6708","07\u6708","08\u6708","09\u6708","10\u6708","11\u6708","12\u6708"],a=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],j=/^(\+|\-)?(\d+)(M|Y)$/i,c=function(k,l){return 32-new Date(k,l,32).getDate()},g=function(k,l){return new Date(k,l,1).getDay()},b=function(m,k){var l=""+m;while(l.length<k){l="0"+l}return l},i=function(k){return k.is("select, input")?k.val():k.attr("data-value")},h;e.ui.define("calendar",{_data:{date:null,firstDay:1,maxDate:null,minDate:null,swipeable:false,monthChangeable:false,yearChangeable:false},_create:function(){var k=this.root();k=k||this.root(e("<div></div>"));k.appendTo(this.data("container")||(k.parent().length?"":document.body))},_init:function(){var m=this._data,l=this._container||this.root(),k=e.proxy(this._eventHandler,this);this.minDate(m.minDate).maxDate(m.maxDate).date(m.date||new Date()).refresh();l.addClass("ui-calendar").on("click",k).highlight();m.swipeable&&l.on("swipeLeft swipeRight",k)},_eventHandler:function(r){var p=this._data,l=(this._container||this.root()).get(0),o,q,k,n,m;switch(r.type){case"swipeLeft":case"swipeRight":return this.switchMonthTo((r.type=="swipeRight"?"-":"+")+"1M");case"change":m=e(".ui-calendar-header .ui-calendar-year, .ui-calendar-header .ui-calendar-month",this._el);return this.switchMonthTo(i(m.eq(1)),i(m.eq(0)));default:q=r.target;if((o=e(q).closest(".ui-calendar-calendar tbody a",l))&&o.length){r.preventDefault();k=o.parent();this._option("selectedDate",n=new Date(k.attr("data-year"),k.attr("data-month"),o.text()));this.trigger("select",[n,e.calendar.formatDate(n),this]);this.refresh()}else{if((o=e(q).closest(".ui-calendar-prev, .ui-calendar-next",l))&&o.length){r.preventDefault();this.switchMonthTo((o.is(".ui-calendar-prev")?"-":"+")+"1M")}}}},_option:function(l,p){var n=this._data,k,m,o;if(p!==d){switch(l){case"minDate":case"maxDate":n[l]=p?e.calendar.parseDate(p):null;break;case"selectedDate":m=n.minDate;o=n.maxDate;p=e.calendar.parseDate(p);p=m&&m>p?m:o&&o<p?o:p;n._selectedYear=n._drawYear=p.getFullYear();n._selectedMonth=n._drawMonth=p.getMonth();n._selectedDay=p.getDate();break;case"date":this._option("selectedDate",p);n[l]=this._option("selectedDate");break;default:n[l]=p}n._invalid=true;return this}return l=="selectedDate"?new Date(n._selectedYear,n._selectedMonth,n._selectedDay):n[l]},switchToToday:function(){var k=new Date();return this.switchMonthTo(k.getMonth(),k.getFullYear())},switchMonthTo:function(o,l){var n=this._data,m=this.minDate(),r=this.maxDate(),q,p,k;if(e.isString(o)&&j.test(o)){q=RegExp.$1=="-"?-parseInt(RegExp.$2,10):parseInt(RegExp.$2,10);p=RegExp.$3.toLowerCase();o=n._drawMonth+(p=="m"?q:0);l=n._drawYear+(p=="y"?q:0)}else{o=parseInt(o,10);l=parseInt(l,10)}k=new Date(l,o,1);k=m&&m>k?m:r&&r<k?r:k;o=k.getMonth();l=k.getFullYear();if(o!=n._drawMonth||l!=n._drawYear){this.trigger("monthchange",[n._drawMonth=o,n._drawYear=l,this]);n._invalid=true;this.refresh()}return this},refresh:function(){var m=this._data,l=this._container||this.root(),k=e.proxy(this._eventHandler,this);if(!m._invalid){return}e(".ui-calendar-calendar td:not(.ui-state-disabled), .ui-calendar-header a",l).highlight();e(".ui-calendar-header select",l).off("change",k);l.empty().append(this._generateHTML());e(".ui-calendar-calendar td:not(.ui-state-disabled), .ui-calendar-header a",l).highlight("ui-state-hover");e(".ui-calendar-header select",l).on("change",k);m._invalid=false;return this},destroy:function(){var l=this._container||this.root(),k=this._eventHandler;e(".ui-calendar-calendar td:not(.ui-state-disabled)",l).highlight();e(".ui-calendar-header select",l).off("change",k);return this.$super("destroy")},_generateHTML:function(){var t=this._data,p=t._drawYear,u=t._drawMonth,o=new Date(),y=new Date(o.getFullYear(),o.getMonth(),o.getDate()),r=this.minDate(),m=this.maxDate(),w=this.selectedDate(),v="",s,q,l,z,x,k,A,n;l=(isNaN(l=parseInt(t.firstDay,10))?0:l);v+=this._renderHead(t,p,u,r,m)+'<table  class="ui-calendar-calendar"><thead><tr>';for(s=0;s<7;s++){z=(s+l)%7;v+="<th"+((s+l+6)%7>=5?' class="ui-calendar-week-end"':"")+"><span>"+a[z]+"</span></th>"}v+='</thead></tr><tbody><tr class="ui-calendar-gap"><td colspan="7">&#xa0;</td></tr>';k=c(p,u);x=(g(p,u)-l+7)%7;A=Math.ceil((x+k)/7);n=new Date(p,u,1-x);for(s=0;s<A;s++){v+="<tr>";for(q=0;q<7;q++){v+=this._renderDay(q,n,l,u,w,y,r,m);n.setDate(n.getDate()+1)}v+="</tr>"}v+="</tbody></table>";return v},_renderHead:function(p,m,q,n,k){var r='<div class="ui-calendar-header">',l=new Date(m,q,-1),s=new Date(m,q+1,1),o,t;r+='<a class="ui-calendar-prev'+(n&&n>l?" ui-state-disable":"")+'" href="#">&lt;&lt;</a><div class="ui-calendar-title">';if(p.yearChangeable){r+='<select class="ui-calendar-year">';for(o=Math.max(1970,m-10),t=o+20;o<t;o++){r+='<option value="'+o+'" '+(o==m?'selected="selected"':"")+">"+o+"\u5e74</option>"}r+="</select>"}else{r+='<span class="ui-calendar-year" data-value="'+m+'">'+m+"\u5e74</span>"}if(p.monthChangeable){r+='<select class="ui-calendar-month">';for(o=0;o<12;o++){r+='<option value="'+o+'" '+(o==q?'selected="selected"':"")+">"+f[o]+"</option>"}r+="</select>"}else{r+='<span class="ui-calendar-month" data-value="'+q+'">'+f[q]+"</span>"}r+='</div><a class="ui-calendar-next'+(k&&k<s?" ui-state-disable":"")+'" href="#">&gt;&gt;</a></div>';return r},_renderDay:function(q,n,l,r,s,t,p,k){var m=(n.getMonth()!==r),o;o=m||(p&&n<p)||(k&&n>k);return"<td class='"+((q+l+6)%7>=5?"ui-calendar-week-end":"")+(o?" ui-calendar-unSelectable ui-state-disabled":"")+(m||o?"":(n.getTime()===s.getTime()?" ui-calendar-current-day":"")+(n.getTime()===t.getTime()?" ui-calendar-today":""))+"'"+(o?"":" data-month='"+n.getMonth()+"' data-year='"+n.getFullYear()+"'")+">"+(m?"&#xa0;":(o?"<span class='ui-state-default'>"+n.getDate()+"</span>":"<a class='ui-state-default"+(n.getTime()===t.getTime()?" ui-state-highlight":"")+(n.getTime()===s.getTime()?" ui-state-active":"")+"' href='#'>"+n.getDate()+"</a>"))+"</td>"}});h=e.ui.calendar.prototype;e.each(["maxDate","minDate","date","selectedDate"],function(l,k){h[k]=function(m){return this._option(k,m)}});e.calendar={parseDate:function(l){var k=/^(\d{4})(?:\-|\/)(\d{1,2})(?:\-|\/)(\d{1,2})$/;return e.isDate(l)?l:k.test(l)?new Date(parseInt(RegExp.$1,10),parseInt(RegExp.$2,10)-1,parseInt(RegExp.$3,10)):null},formatDate:function(k){return k.getFullYear()+"-"+b(k.getMonth()+1,2)+"-"+b(k.getDate(),2)}}})(Zepto);