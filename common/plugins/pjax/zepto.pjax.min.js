(function(n){function e(t,i,r){var u,f;if(r=s(i,r),u=t.currentTarget,u.tagName.toUpperCase()!=="A")throw"$.fn.pjax or $.pjax.click requires an anchor element";t.which>1||t.metaKey||t.ctrlKey||location.protocol===u.protocol&&location.host===u.host&&(u.hash&&u.href.replace(u.hash,"")===location.href.replace(location.hash,"")||u.href!==location.href+"#"&&(f={url:u.href,container:n(u).attr("data-pjax"),target:u,clickedElement:n(u),fragment:null},n.pjax(n.extend({},f,r)),t.preventDefault()))}function o(){return(new Date).getTime()}function a(n){return n.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function f(n){var t=document.createElement("a");return t.href=n,t}function s(t,i){return t&&i?i.container=t:i=n.isPlainObject(t)?t:{container:t},i.container&&(i.container=h(i.container)),i}function h(t){if(t=n(t),t.length){if(t.selector!==""&&t.context===document)return t;if(t.attr("id"))return n("#"+t.attr("id"));throw"cant get selector for pjax container!";}else throw"no pjax container for "+t.selector;}function c(t,i){var r=n();return t.each(function(){n(this).is(i)&&(r=r.add(this)),r=r.add(i,this)}),r}function l(t,i,r){var u={},f,e;return(u.url=a(i.getResponseHeader("X-PJAX-URL")||r.requestUrl),f=n(t),f.length===0)?u:(u.title=c(f,"title").last().text(),r.fragment?(e=c(f,r.fragment).first(),e.length&&(u.contents=e.contents(),u.title||(u.title=e.attr("title")||e.data("title")))):/<html/i.test(t)||(u.contents=f),u.contents&&(u.contents=u.contents.not("title"),u.contents.find("title").remove()),u.title&&(u.title=u.title.trim()),u)}function v(n,f){for(i[n]=f,r.push(n);u.length;)delete i[u.shift()];while(r.length>t.defaults.maxCacheLength)delete i[r.shift()]}function y(n,t,f){var e,o;i[t]=f,n==="forward"?(e=r,o=u):(e=u,o=r),e.push(t),(t=o.pop())&&delete i[t]}var t;n.noop=function(){},n.fn.pjax=function(n,t,i){return this.on("click.pjax",n,function(n){e(n,t,i)})},t=n.pjax=function(i){function r(t,i){console.log(" type ",t);var r=n.Event(t,{relatedTarget:e});return(u.trigger(r,i),r.isDefaultPrevented)?!r.isDefaultPrevented():!r.defaultPrevented}function nt(n,t){s&&clearTimeout(s),b&&b.apply(this,arguments),r("pjax:complete",[n,t,i]),r("pjax:end",[n,i]),r("end.pjax",[n,i])}function tt(e,s,h){var c=l(e,h,i),a,v;if(!c.contents){window.location=c.url;return}t.state={id:i.id||o(),url:c.url,title:c.title,container:u.selector,fragment:i.fragment,timeout:i.timeout,direction:i.direction,duration:i.duration},(i.push||i.replace)&&window.history.replaceState(t.state,c.title,c.url),c.title&&(document.title=c.title),u.html(c.contents),typeof i.scrollTo=="number"&&n.scrollTop&&n(window).scrollTop(i.scrollTo),(i.replace||i.push)&&window._gaq&&_gaq.push(["_trackPageview"]),w!==""&&(a=f(c.url),a.hash=w,t.state.url=a.href,window.history.replaceState(t.state,c.title,a.href),v=n(a.hash),v.length&&n(window).scrollTop(v.offset().top)),k&&k.apply(this,arguments),r("pjax:success",[e,s,h,i])}var e,s,c,a,y,g,p;i=n.extend({},n.ajaxSettings,t.defaults,i),n.isFunction(i.url)&&(i.url=i.url()),e=i.target,!e&&i.clickedElement&&(e=i.clickedElement[0]);var w=f(i.url).hash,it=i.beforeSend,b=i.complete,k=i.success,d=i.error,u=i.context=h(i.container);return i.data||(i.data={}),i.data._pjax=u.selector,i.beforeSend=function(n,e){var h=e.timeout,o;if(e.timeout>0&&(s=setTimeout(function(){r("pjax:timeout",[n,i])&&n.abort("timeout")},e.timeout),e.timeout=0),e.type!=="GET"&&(e.timeout=0),n.setRequestHeader("X-PJAX","true"),n.setRequestHeader("X-PJAX-Container",u.selector),!r("pjax:beforeSend",[n,e]))return!1;o=e.duration,s&&o>=h&&(o=h-1),o>=0&&o!=null&&(c=setTimeout(function(){if(c=null,y){a&&a(),g&&g(),y();return}r("pjax:waiting",[n,i])},o)),i.push&&!i.replace&&(v(t.state.id,u.clone(!0,!0).contents()),window.history.pushState(null,"",i.url)),i.requestUrl=f(e.url).href,r("pjax:start",[n,i]),r("start.pjax",[n,i]),r("pjax:send",[n,e])},i.complete=function(n,t){y=function(){nt.call(i,n,t)},c||y()},i.error=function(n,t,u){var f,e;console.log("error"),f=l("",n,i),d&&d.apply(this,arguments),e=r("pjax:error",[n,t,u,i]),t!=="abort"&&e&&(window.location=f.url)},i.success=function(n,t,i,r){a=function(){tt.call(r,n,t,i)},c||a()},t.state||(t.state={id:o(),url:window.location.href,title:document.title,container:u.selector,fragment:i.fragment,timeout:i.timeout,direction:i.direction},window.history.replaceState(t.state,document.title)),(p=t.xhr)&&p.readyState<4&&(p.onreadystatechange=n.noop,p.abort()),t.options=i,t.xhr=n.ajax(i),n(document).trigger("pjax",[t.xhr,i]),t.xhr},t.reload=function(t,i){console.log("pjax reload");return n.pjax(n.extend({url:window.location.href,push:!1,replace:!0,scrollTo:!1},s(t,i)))},t.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20};var i={},u=[],r=[];t.click=e,n(window).bind("popstate",function(r){var u,f,s,o,h,e;console.log("popstate args ",arguments),u=r.state,u&&u.container&&(f=n(u.container),f.length?(s=i[u.id],t.state&&(o=t.options.direction=t.state.id<u.id?"forward":"back",y(o,t.state.id,f.clone().contents())),h=n.Event("pjax:popstate",{state:u,direction:o}),f.trigger(h),e={id:u.id,url:u.url,container:f,push:!1,fragment:u.fragment,timeout:u.timeout,scrollTo:!1,direction:o,duration:u.duration},s?(console.log(u),n(document).trigger("pjax",[null,e]),f.trigger("pjax:start",[null,e]),setTimeout(function(){u.title&&(document.title=u.title),f.html(s),t.state=u,f.trigger("pjax:end",[null,e]),f[0].offsetHeight},u.duration||0)):n.pjax(e),f[0].offsetHeight):window.location=location.href)}),n.support={},n.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/),n.support.pjax||(n.pjax=function(t){var f=n.isFunction(t.url)?t.url():t.url,u=t.type?t.type.toUpperCase():"GET",r=n("<form>",{method:u==="GET"?"GET":"POST",action:f,style:"display:none"}),i;if(u!=="GET"&&u!=="POST"&&r.append(n("<input>",{type:"hidden",name:"_method",value:u.toLowerCase()})),i=t.data,typeof i=="string")n.each(i.split("&"),function(t,i){var u=i.split("=");r.append(n("<input>",{type:"hidden",name:u[0],value:u[1]}))});else if(typeof i=="object")for(key in i)r.append(n("<input>",{type:"hidden",name:key,value:i[key]}));n(document.body).append(r),r.submit()},n.pjax.click=n.noop,n.pjax.reload=window.location.reload,n.fn.pjax=function(){return this})})(Zepto||jQuery)