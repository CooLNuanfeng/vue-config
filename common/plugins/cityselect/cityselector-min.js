var Vcity={};Vcity._m={$:function(n,t){var r,f,e=[],i,u=n.substring(1);if(t=t||document,typeof n=="string")switch(n.charAt(0)){case"#":return document.getElementById(u);case".":if(t.getElementsByClassName)return t.getElementsByClassName(u);for(r=Vcity._m.$("*",t),f=r.length,i=0;i<f;i++)r[i].className.indexOf(u)>-1&&e.push(r[i]);return e;default:return t.getElementsByTagName(n)}},on:function(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent("on"+t,i)},getEvent:function(n){return n||window.event},getTarget:function(n){return n.target||n.srcElement},getPos:function(n){var i=document.documentElement.scrollLeft||document.body.scrollLeft,r=document.documentElement.scrollTop||document.body.scrollTop,t=n.getBoundingClientRect();return{top:t.top+r,right:t.right+i,bottom:t.bottom+r,left:t.left+i}},addClass:function(n,t){t&&(t.className=Vcity._m.hasClass(n,t)?t.className:t.className+" "+n)},removeClass:function(n,t){var i=new RegExp("(^|\\s+)"+n+"(\\s+|$)","g");Vcity._m.hasClass(n,t)&&(t.className=i.test(t.className)?t.className.replace(i,""):t.className)},hasClass:function(n,t){return!t||!t.className?!1:t.className.indexOf(n)>-1},stopPropagation:function(n){n=n||window.event,n.stopPropagation?n.stopPropagation():n.cancelBubble=!0},trim:function(n){return n.replace(/^\s+|\s+$/g,"")}},Vcity.allCity=cityConfig.allcity,Vcity.regEx=/^([\u4E00-\u9FA5\uf900-\ufa2d]+)\|(\w+)\|(\w)\w*\|([\d\-]*)(?:(?:\|){1}([0,1]{1}))?$/i,Vcity.regExChiese=/([\u4E00-\u9FA5\uf900-\ufa2d]+)/,function(){var u=Vcity.allCity,i,n,e=Vcity.regEx,r,f,t;if(!Vcity.oCity)for(Vcity.oCity={hot:{},ABC:{},DEFG:{},HIJ:{},KLMNO:{},PQRS:{},TUVWX:{},YZ:{}},r=0,f=u.length;r<f;r++)i=e.exec(u[r]),n=i[3].toUpperCase(),t=i[1]+"|"+i[4],i[5]!=="0"&&(/^[a-c]$/i.test(n)?(Vcity.oCity.ABC[n]||(Vcity.oCity.ABC[n]=[]),Vcity.oCity.ABC[n].push(t)):/^[d-g]$/i.test(n)?(Vcity.oCity.DEFG[n]||(Vcity.oCity.DEFG[n]=[]),Vcity.oCity.DEFG[n].push(t)):/^[h-j]$/i.test(n)?(Vcity.oCity.HIJ[n]||(Vcity.oCity.HIJ[n]=[]),Vcity.oCity.HIJ[n].push(t)):/^[k-o]$/i.test(n)?(Vcity.oCity.KLMNO[n]||(Vcity.oCity.KLMNO[n]=[]),Vcity.oCity.KLMNO[n].push(t)):/^[p-s]$/i.test(n)?(Vcity.oCity.PQRS[n]||(Vcity.oCity.PQRS[n]=[]),Vcity.oCity.PQRS[n].push(t)):/^[t-x]$/i.test(n)?(Vcity.oCity.TUVWX[n]||(Vcity.oCity.TUVWX[n]=[]),Vcity.oCity.TUVWX[n].push(t)):/^[y-z]$/i.test(n)&&(Vcity.oCity.YZ[n]||(Vcity.oCity.YZ[n]=[]),Vcity.oCity.YZ[n].push(t)),r<cityConfig.hotsize&&(Vcity.oCity.hot.hot||(Vcity.oCity.hot.hot=[]),Vcity.oCity.hot.hot.push(t)))}(),Vcity._template=['<p class="tip">热门城市(支持汉字/拼音)<\/p>',"<ul>",'<li class="on">热门城市<\/li>',"<li>A-C<\/li>","<li>D-G<\/li>","<li>H-J<\/li>","<li>K-O<\/li>","<li>P-S<\/li>","<li>T-X<\/li>","<li>Y-Z<\/li>","<\/ul>"],Vcity.CitySelector=function(){this.initialize.apply(this,arguments)},Vcity.CitySelector.prototype={constructor:Vcity.CitySelector,initialize:function(n){var t=n.input,i=n.container,r=n.citycode;this.input=Vcity._m.$("#"+t),this.container=Vcity._m.$("#"+i),this.citycode=r,this.inputEvent(),this.citycode&&this.createCodeInput()},createCodeInput:function(){$(this.input).after('<input type="hidden" name="'+this.citycode+'" value="" />')},createWarp:function(){var u=Vcity._m.getPos(this.input),t=this.rootDiv=document.createElement("div"),n=this,e=$(this.input),o=e.offset(),l=$(this.container),s=l.offset(),h,c,r,i,f;this.container&&(u.left=o.left-s.left,u.top=o.top-s.top+e.height());Vcity._m.on(this.rootDiv,"click",function(n){Vcity._m.stopPropagation(n)});Vcity._m.on(document,"click",function(t){t=Vcity._m.getEvent(t);var i=Vcity._m.getTarget(t);if(i==n.input)return!1;n.cityBox&&Vcity._m.addClass("hide",n.cityBox),n.ul&&Vcity._m.addClass("hide",n.ul),n.myIframe&&Vcity._m.addClass("hide",n.myIframe)});t.className="citySelector",t.style.position="absolute",t.style.left=u.left+"px",t.style.top=u.top+"px",t.style.zIndex=999999,h=document.all?!0:!1,c=this.isIE6=h&&!window.XMLHttpRequest,c&&(r=this.myIframe=document.createElement("iframe"),r.frameborder="0",r.src="about:blank",r.style.position="absolute",r.style.zIndex="-1",this.rootDiv.appendChild(this.myIframe)),i=this.cityBox=document.createElement("div"),i.className="cityBox",i.id="cityBox",i.innerHTML=Vcity._template.join(""),f=this.hotCity=document.createElement("div"),f.className="hotCity",i.appendChild(f),t.appendChild(i),this.createHotCity()},createHotCity:function(){var r,u,o,s,h=[],l,i,a,n,p=Vcity.regEx,f=Vcity.oCity,t,v,e,y,c;for(i in f){r=this[i]=document.createElement("div"),r.className=i+" cityTab hide",n=[];for(a in f[i])n.push(a),n.sort();for(t=0,v=n.length;t<v;t++){for(u=document.createElement("dl"),o=document.createElement("dt"),s=document.createElement("dd"),o.innerHTML=n[t]=="hot"?"&nbsp;":n[t],h=[],e=0,y=f[i][n[t]].length;e<y;e++)c=f[i][n[t]][e].split("|"),l='<a data-code="'+c[1]+'" href="javascript:void(0);">'+c[0]+"<\/a>",h.push(l);s.innerHTML=h.join(""),u.appendChild(o),u.appendChild(s),r.appendChild(u)}Vcity._m.removeClass("hide",this.hot),this.hotCity.appendChild(r)}(this.container||document.body).appendChild(this.rootDiv),this.changeIframe(),this.tabChange(),this.linkEvent()},tabChange:function(){for(var t=Vcity._m.$("li",this.cityBox),r=Vcity._m.$("div",this.hotCity),u=this,n=0,i=t.length;n<i;n++)t[n].index=n,t[n].onclick=function(){for(var n=0;n<i;n++)Vcity._m.removeClass("on",t[n]),Vcity._m.addClass("hide",r[n]);Vcity._m.addClass("on",this),Vcity._m.removeClass("hide",r[this.index]),u.changeIframe()}},linkEvent:function(){for(var i=Vcity._m.$("a",this.hotCity),n=this,t=0,r=i.length;t<r;t++)i[t].onclick=function(){n.input.value=this.innerHTML,n.citycode&&$(n.input).siblings("input[name="+n.citycode+"]").val($(this).attr("data-code")),Vcity._m.addClass("hide",n.cityBox),Vcity._m.addClass("hide",n.myIframe)}},inputEvent:function(){var n=this;Vcity._m.on(this.input,"click",function(t){t=t||window.event,n.cityBox?!!n.cityBox&&Vcity._m.hasClass("hide",n.cityBox)&&(!n.ul||n.ul&&Vcity._m.hasClass("hide",n.ul))&&(Vcity._m.removeClass("hide",n.cityBox),Vcity._m.removeClass("hide",n.myIframe),n.changeIframe()):n.createWarp()});Vcity._m.on(this.input,"focus",function(){n.input.select(),n.input.value==""&&(n.input.value="")});Vcity._m.on(this.input,"blur",function(){n.input.value==""&&(n.input.value="")});Vcity._m.on(this.input,"keyup",function(t){t=t||window.event;var i=t.keyCode;Vcity._m.addClass("hide",n.cityBox),n.createUl(),Vcity._m.removeClass("hide",n.myIframe),!n.ul||Vcity._m.hasClass("hide",n.ul)||n.isEmpty||n.KeyboardEvent(t,i)})},createUl:function(){var r,u=Vcity._m.trim(this.input.value),e,t,i,o,n,f;if(u!==""){for(e=new RegExp("^"+u+"|\\|"+u,"gi"),t=[],i=0,o=Vcity.allCity.length;i<o;i++)e.test(Vcity.allCity[i])&&(n=Vcity.regEx.exec(Vcity.allCity[i]),r=t.length!==0?'<li data-code="'+n[4]+'"><b class="cityname">'+n[1]+'<\/b><b class="cityspell">'+n[2]+"<\/b><\/li>":'<li class="on" data-code="'+n[4]+'"><b class="cityname">'+n[1]+'<\/b><b class="cityspell">'+n[2]+"<\/b><\/li>",t.push(r));this.isEmpty=!1,t.length==0&&(this.isEmpty=!0,r='<li class="empty">对不起，没有找到数据 "<em>'+u+'<\/em>"<\/li>',t.push(r)),this.ul?this.ul&&Vcity._m.hasClass("hide",this.ul)&&(this.count=0,Vcity._m.removeClass("hide",this.ul)):(f=this.ul=document.createElement("ul"),f.className="cityslide",this.rootDiv&&this.rootDiv.appendChild(f),this.count=0),this.ul.innerHTML=t.join(""),this.changeIframe(),this.liEvent()}else Vcity._m.addClass("hide",this.ul),Vcity._m.removeClass("hide",this.cityBox),Vcity._m.removeClass("hide",this.myIframe),this.changeIframe()},changeIframe:function(){this.isIE6&&(this.myIframe.style.width=this.rootDiv.offsetWidth+"px",this.myIframe.style.height=this.rootDiv.offsetHeight+"px")},KeyboardEvent:function(n,t){var r=Vcity._m.$("li",this.ul),u=r.length,i;switch(t){case 40:for(this.count++,this.count>u-1&&(this.count=0),i=0;i<u;i++)Vcity._m.removeClass("on",r[i]);Vcity._m.addClass("on",r[this.count]);break;case 38:for(this.count--,this.count<0&&(this.count=u-1),i=0;i<u;i++)Vcity._m.removeClass("on",r[i]);Vcity._m.addClass("on",r[this.count]);break;case 13:this.input.value=Vcity.regExChiese.exec(r[this.count].innerHTML)[0],this.citycode&&$(this.input).siblings("input[name="+this.citycode+"]").val($(r[this.count]).attr("data-code")),Vcity._m.addClass("hide",this.ul),Vcity._m.addClass("hide",this.ul),Vcity._m.addClass("hide",this.myIframe)}},liEvent:function(){for(var t=this,i=Vcity._m.$("li",this.ul),n=0,r=i.length;n<r;n++){Vcity._m.on(i[n],"click",function(n){n=Vcity._m.getEvent(n);var i=Vcity._m.getTarget(n),r=t.citycode;t.input.value=Vcity.regExChiese.exec(i.innerHTML)[0],r&&$(t.input).siblings("input[name="+r+"]").val($(i).attr("data-code")),Vcity._m.addClass("hide",t.ul),Vcity._m.addClass("hide",t.myIframe)});Vcity._m.on(i[n],"mouseover",function(n){n=Vcity._m.getEvent(n);var t=Vcity._m.getTarget(n);Vcity._m.addClass("on",t)});Vcity._m.on(i[n],"mouseout",function(n){n=Vcity._m.getEvent(n);var t=Vcity._m.getTarget(n);Vcity._m.removeClass("on",t)})}}}